.sub-header.gray
  .container
    .row 
      .span1
        = image_tag @user.gravatar_url
      .span3
        %h3= @user.full_name
        == Member since #{formatted_date(@user.created_at)}
        %br/
        = link_to 'Edit profile', user_path(@user)

      .span1.text-center
        %h1
          = @user.actions.count
        - if @user.actions.count == 1
          Report
        - else
          Reports

      .span1.text-center
        %h1
          = @user.channels.count
        - if @user.channels.count == 1
          Channel
        - else
          Channels

      .span1.text-center
        %h1
          = @user.completed_campaigns.count
        - if @user.completed_campaigns.count == 1
          Badge
        - else
          Badges

      .span1.text-center
        %h1
          1
        Reach (mi)

      .span1.text-center

      .span3
        - if @user == current_user
          - unless @user.providers.where(provider: 'foursquare').present?
            %div{style: 'margin-bottom: 10px'}
              = link_to image_tag('foursquare.jpg'), user_omniauth_authorize_path('foursquare')
              = link_to 'Connect Foursquare account', user_omniauth_authorize_path('foursquare')
          - unless @user.providers.where(provider: 'instagram').present?
            %div
              = link_to image_tag('instagram.png'), user_omniauth_authorize_path('instagram')
              = link_to 'Connect Instagram account', user_omniauth_authorize_path('instagram')

.page.container
  %h2
    Current Campaigns
  %br/
  - for campaign in @active_campaigns
    .campaign-row
      .row
        .span1.text-right
          = image_tag campaign.individual_badge.url
        .span6
          .title
            %strong
              = campaign.name
            %small
              %small
                == &nbsp;#{distance_of_time_in_words(campaign.time_left)} left
          %p= campaign.description
      .row
        .span1
        .span6
          .progress-row
            .progress
              - if campaign.progress_by_individual(@user) >= 1.0
                .bar.bar-warning{:style=>"width: #{individual_progress_bar_helper(campaign, @user)};"}
              - else
                .bar.bar-info{:style=>"width: #{individual_progress_bar_helper(campaign, @user)};"}
            .pull-right
              = campaign.required_individual_occurrences
            0

          .progress-row
            .progress
              - if campaign.progress_by_community >= 1.0
                .bar.bar-warning{:style=>"width: #{community_progress_bar_helper(campaign)};"}
              - else
                .bar.bar-success{:style=>"width: #{community_progress_bar_helper(campaign)};"}
            .pull-right
              = campaign.required_community_occurrences
            0

        .span2
          .individual
            %em
              Individual Goal
          .community
            %em
              Community Goal


  .row
    .span8
      %h3 Completed Campaigns
      - for campaign in @completed_campaigns
        .row
          .span8
            .title= campaign.name

  %script{:src => 'http://beta.openbadges.org/issuer.js'}
  :javascript
    $(document).ready(function() {
      $('.openbadge-link').on('click', function(e) {
        var campaign = $(e.target).data('api');
        OpenBadges.issue(campaign, function(errors, successes) {
          console.log(errors,successes);
        });
      });
    });
